<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cek Ongkos Akomodasi - Nanda Teknik</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .mobile-container { max-width: 480px; min-height: 100vh; margin: 0 auto; background: #f9fafb; position: relative; }
        #map { height: 350px; width: 100%; border-radius: 2rem; z-index: 1; }
        .result-card { transform: translateY(-50px); z-index: 10; position: relative; }
    </style>
</head>
<body class="bg-gray-200">

    <div class="mobile-container shadow-2xl flex flex-col pb-32">
        
        <header class="bg-white pt-10 pb-6 px-6 rounded-b-[2.5rem] shadow-sm flex items-center justify-between">
            <a href="dashboard.html" class="p-2 bg-gray-50 rounded-xl">
                <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </a>
            <h1 class="text-lg font-bold text-gray-800">Estimasi Akomodasi</h1>
            <div class="w-10"></div>
        </header>

        <main class="flex-grow p-4">
            <div class="relative">
                <div id="map" class="shadow-inner border-4 border-white"></div>
                <button onclick="locateUser()" class="absolute bottom-4 right-4 bg-white p-3 rounded-full shadow-lg z-[1000] border border-gray-100">
                    <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path></svg>
                </button>
            </div>

            <div class="result-card px-4">
                <div class="bg-white rounded-[2rem] p-6 shadow-xl border border-blue-50">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-xs text-gray-400 font-semibold uppercase tracking-wider">Jarak dari Sukowidi</p>
                            <h2 id="distanceText" class="text-3xl font-black text-gray-800">0 <span class="text-sm font-normal text-gray-400">Km</span></h2>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-2xl text-blue-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        </div>
                    </div>

                    <div class="space-y-3 border-t border-dashed border-gray-100 pt-4">
                        <div class="flex justify-between">
                            <span class="text-gray-500 text-sm">Biaya Akomodasi:</span>
                            <span id="costText" class="font-bold text-green-600 text-lg">Gratis</span>
                        </div>
                        <p id="noteText" class="text-[10px] text-gray-400 italic text-center">* Geser pin biru ke lokasi rumah Anda untuk akurasi biaya.</p>
                    </div>

                    <button class="w-full mt-6 bg-gray-900 text-white py-4 rounded-2xl font-bold shadow-lg shadow-gray-200 hover:bg-black transition-all">
                        Pesan Servis Sekarang
                    </button>
                </div>
            </div>
        </main>

        </div>

    <script>
        // Titik Tengah Rumah (Sukowidi)
        const sukowidiLoc = [-8.1832, 114.3727]; 
        const banyuwangiKotaRadius = 5; // Radius gratis (Km)
        const costPerKm = 10000;

        // Inisialisasi Map
        const map = L.map('map').setView(sukowidiLoc, 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // Marker Rumah Nanda (Sukowidi) - Merah
        L.circle(sukowidiLoc, {radius: 500, color: 'red', fillOpacity: 0.1}).addTo(map);
        L.marker(sukowidiLoc, {icon: L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41]
        })}).addTo(map).bindPopup("Nanda Teknik (Sukowidi)");

        // Marker Pelanggan - Biru (Bisa Digeser)
        let customerMarker = L.marker(sukowidiLoc, {
            draggable: true,
            icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41], iconAnchor: [12, 41]
            })
        }).addTo(map);

        // Fungsi Hitung Jarak (Haversine Formula)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; 
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function updateInfo(latlng) {
            const dist = calculateDistance(sukowidiLoc[0], sukowidiLoc[1], latlng.lat, latlng.lng);
            const roundedDist = dist.toFixed(1);
            
            document.getElementById('distanceText').innerHTML = `${roundedDist} <span class="text-sm font-normal text-gray-400">Km</span>`;

            let cost = 0;
            if (dist > banyuwangiKotaRadius) {
                // Jika diluar kota (lebih dari 5km), hitung per km
                cost = Math.ceil(dist) * costPerKm;
                document.getElementById('costText').innerText = `Rp ${cost.toLocaleString('id-ID')}`;
                document.getElementById('costText').classList.replace('text-green-600', 'text-blue-600');
            } else {
                document.getElementById('costText').innerText = "Gratis";
                document.getElementById('costText').classList.replace('text-blue-600', 'text-green-600');
            }
        }

        // Event saat pin digeser
        customerMarker.on('dragend', function(e) {
            updateInfo(e.target.getLatLng());
        });

        // Fungsi Deteksi Lokasi Saya
        function locateUser() {
            map.locate({setView: true, maxZoom: 16});
        }

        map.on('locationfound', function(e) {
            customerMarker.setLatLng(e.latlng);
            updateInfo(e.latlng);
        });

        map.on('locationerror', function() {
            alert("Gagal mendapatkan lokasi. Silakan geser pin manual.");
        });

    </script>
</body>
</html>
